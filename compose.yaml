services:
  satisfactory:
    image: ghcr.io/miyaji255/satisfactory-oucc-server:main
    container_name: satisfactory-server
    hostname: satisfactory-server
    restart: unless-stopped
    network_mode: host

    environment:
      # Tailscale
      TS_AUTH_KEY: ${TS_AUTH_KEY}
      TS_HOSTNAME: ${TS_HOSTNAME:-satisfactory}
      TS_EXTRA_ARGS: ${TS_EXTRA_ARGS:-}

      # NetBird
      NB_SETUP_KEY: ${NB_SETUP_KEY}
      NB_HOSTNAME: ${NB_HOSTNAME:-satisfactory}
      NB_MANAGEMENT_URL: ${NB_MANAGEMENT_URL:-}

      # Discord Bot
      SATISFACTORY_BOT_DISCORD_TOKEN: ${SATISFACTORY_BOT_DISCORD_TOKEN}

      # Satisfactory Server
      MAXPLAYERS: ${MAXPLAYERS:-4}
      PGID: ${PGID:-1000}
      PUID: ${PUID:-1000}
      STEAMBETA: ${STEAMBETA:-false}
      DISABLESEASONALEVENTS: ${DISABLESEASONALEVENTS:-false}

    volumes:
      # Satisfactory server configuration and saves
      # Contains: /backups, /gamefiles, /logs, /saved
      - ./config:/config
      - ./steamcmd:/steamcmd
      - ./steamapps:/steamapps
      - ./steam-root:/root/.steam
      - ./steam-home:/home/steam/.steam
      # Tailscale state (for persistent identity)
      - tailscale-state:/var/lib/tailscale
      # NetBird state (for persistent identity)
      - netbird-state:/var/lib/netbird

    # Required for Tailscale and NetBird
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE
    devices:
      - /dev/net/tun:/dev/net/tun

volumes:
  tailscale-state:
  netbird-state:
